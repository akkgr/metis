{"version":3,"sources":["services/api.js","components/map/mapUtilities.js","services/hubConnectionBuilder.js","components/containers/MapContainer.js","components/map/Map.js","components/map/MapAlarm.js","components/map/MapAlarms.js","components/map/MobileMapLayout.js"],"names":["baseUrl","process","getHeaders","headers","Headers","append","token","storage","get","concat","getJson","_callee6","req","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_2___default","a","wrap","_context6","prev","next","json","abrupt","sent","t0","stop","request","_callee7","_ref","method","url","data","res","_context7","fetch","body","JSON","stringify","ok","Error","Message","statusText","status","antd_es_notification__WEBPACK_IMPORTED_MODULE_1__","placement","message","description","api","_get","Object","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__","mark","_callee","_context","_x3","apply","this","arguments","post","_post","_callee2","_context2","_x4","_x5","put","_put","_callee3","_context3","_x6","_x7","patch","_patch","_callee4","_context4","_x8","_x9","delete","_delete2","_callee5","_context5","_x10","__webpack_require__","d","__webpack_exports__","HUB_URL","TILE_LAYERS","MAP_CENTER","statusColor","FILTER","applyFilter","LIGHT","LIGHT_LABELS","DARK","DARK_LABELS","lat","lng","Alarm","Ok","NotFound","Maintenance","Selected","Pending","key","enabled","color","site","filter","filterText","find","x","category","name","toLowerCase","match","SERVER_TIMEOUT","RECONNECT_DELAY","connection","start","_start","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_0___default","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_1__","console","log","setTimeout","HubConnectionBuilder","withUrl","accessTokenFactory","configureLogging","LogLevel","Debug","build","serverTimeoutInMilliseconds","onclose","hubConnectionBuilder","MapContainer","children","hub","useRef","_useState","useState","_useState2","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_4__","sites","setSites","_useState3","_useState4","messages","setMessages","_useState5","_useState6","selected","setSelected","_useState7","_useState8","alarm","setAlarm","onMaintenanceStart","_onMaintenanceStart","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_regenerator__WEBPACK_IMPORTED_MODULE_1___default","ps","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_objectSpread__WEBPACK_IMPORTED_MODULE_0__","id","onMaintenanceStop","_onMaintenanceStop","useEffect","_fetchSites","response","fetchSites","then","con","current","on","info","previousStatus","currentStatus","D_github_metis_Metis_Web_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_2__","slice","catch","err","error","prevSites","idx","indexOf","splice","prevSelected","React","Children","map","child","cloneElement","react__WEBPACK_IMPORTED_MODULE_0__","react__WEBPACK_IMPORTED_MODULE_0___default","n","react_leaflet__WEBPACK_IMPORTED_MODULE_1__","react_leaflet__WEBPACK_IMPORTED_MODULE_2__","react_leaflet__WEBPACK_IMPORTED_MODULE_3__","leaflet__WEBPACK_IMPORTED_MODULE_4__","leaflet__WEBPACK_IMPORTED_MODULE_4___default","_mapUtilities__WEBPACK_IMPORTED_MODULE_6__","Map","onSelect","createElement","center","zoom","className","latitude","position","longitude","icon","leaflet","DivIcon","onclick","MapAlarm","isExpanded","react_default","style","fontSize","fontWeight","Date","toLocaleTimeString","MapAlarms","alarms","containerRef","slicedToArray","setIsExpanded","ref","display","justifyContent","onClick","height","width","type","title","map_MapAlarm","r","_containers_MapContainer__WEBPACK_IMPORTED_MODULE_1__","_Map__WEBPACK_IMPORTED_MODULE_2__","_MapAlarms__WEBPACK_IMPORTED_MODULE_3__","WebMapLayoutView","flexGrow","hidden","values","WebMapLayout"],"mappings":"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","file":"static/js/14.c41f66d4.chunk.js","sourcesContent":["import { notification as antdNotification } from 'antd'\r\nimport storage from './storage'\r\n\r\nconst baseUrl = process.env.REACT_APP_API_URL\r\n\r\nfunction getHeaders() {\r\n  const headers = new Headers()\r\n  headers.append('Content-Type', 'application/json')\r\n  const token = storage.get('token')\r\n  if (token) {\r\n    headers.append('Authorization', `Bearer ${token}`)\r\n  }\r\n  return headers\r\n}\r\n\r\nasync function getJson(req) {\r\n  try {\r\n    return await req.json()\r\n  } catch (err) {\r\n    return null\r\n  }\r\n}\r\n\r\nasync function request({ method, url, data }) {\r\n  try {\r\n    const req = await fetch(baseUrl + url, {\r\n      method: method,\r\n      headers: getHeaders(),\r\n      body: data && JSON.stringify(data)\r\n    })\r\n\r\n    const res = await getJson(req)\r\n    if (!req.ok) {\r\n      throw new Error(\r\n        (res && res.Message) || `${req.statusText} (${req.status})`\r\n      )\r\n    }\r\n    return res\r\n  } catch (err) {\r\n    antdNotification['error']({\r\n      placement: 'bottomRight',\r\n      message: 'Σφάλμα',\r\n      description: err.message\r\n    })\r\n    return null\r\n  }\r\n}\r\n\r\nconst api = {\r\n  get: async url => await request({ method: 'GET', url }),\r\n  post: async (url, data) => await request({ method: 'POST', url, data }),\r\n  put: async (url, data) => await request({ method: 'PUT', url, data }),\r\n  patch: async (url, data) => await request({ method: 'PATCH', url, data }),\r\n  delete: async url => await request({ method: 'DELETE', url })\r\n}\r\n\r\nexport default api\r\n","export const HUB_URL = `${process.env.REACT_APP_API_URL}/guard`\r\n\r\nexport const TILE_LAYERS = {\r\n  LIGHT:\r\n    'https://server.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}',\r\n  LIGHT_LABELS: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\r\n  DARK: 'https://{s}.basemaps.cartocdn.com/dark_nolabels/{z}/{x}/{y}{r}.png',\r\n  DARK_LABELS: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png'\r\n}\r\n\r\nexport const MAP_CENTER = {\r\n  lat: 38.0,\r\n  lng: 25.0\r\n}\r\n\r\nexport const statusColor = {\r\n  Alarm: '#f5222d',\r\n  Ok: '#52c41a',\r\n  NotFound: '#1890ff',\r\n  Maintenance: '#faad14',\r\n  Selected: 'cyan',\r\n  Pending: '#fadb14'\r\n}\r\n\r\nexport const FILTER = [\r\n  { key: 'Ok', enabled: false, color: statusColor['Ok'] },\r\n  { key: 'Alarm', enabled: true, color: statusColor['Alarm'] },\r\n  { key: 'Maintenance', enabled: true, color: statusColor['Maintenance'] },\r\n  { key: 'NotFound', enabled: false, color: statusColor['NotFound'] },\r\n  { key: 'Pending', enabled: false, color: statusColor['Pending'] },\r\n  { key: 'Δήμοι', enabled: true, color: '#2abbbb' }\r\n]\r\n\r\nexport function applyFilter(site, filter, filterText) {\r\n  return (\r\n    filter.find(x => x.key === site.status).enabled &&\r\n    filter.find(x => x.key === site.category).enabled &&\r\n    site.name.toLowerCase().match(filterText)\r\n  )\r\n}\r\n","import { HubConnectionBuilder, LogLevel } from '@aspnet/signalr'\r\nimport storage from './storage'\r\n\r\n// connection timeout if no messages received (120.000ms = 120s = 2m)\r\nconst SERVER_TIMEOUT = 2 * 60 * 1000\r\nconst RECONNECT_DELAY = 6 * 1000\r\n\r\nasync function hubConnectionBuilder(url) {\r\n  const connection = new HubConnectionBuilder()\r\n    .withUrl(url, { accessTokenFactory: () => storage.get('token') })\r\n    .configureLogging(LogLevel.Debug)\r\n    .build()\r\n\r\n  connection.serverTimeoutInMilliseconds = SERVER_TIMEOUT\r\n\r\n  async function start() {\r\n    if (!storage.get('token')) {\r\n      return\r\n    }\r\n    try {\r\n      await connection.start()\r\n    } catch (err) {\r\n      console.log(err)\r\n      setTimeout(() => start(), RECONNECT_DELAY)\r\n    }\r\n  }\r\n\r\n  connection.onclose(async () => {\r\n    //await start()\r\n  })\r\n\r\n  await start()\r\n\r\n  return connection\r\n}\r\n\r\nexport default hubConnectionBuilder\r\n","import React, { useState, useEffect, useRef } from 'react'\r\nimport hubConnectionBuilder from '../../services/hubConnectionBuilder'\r\nimport { HUB_URL } from '../map/mapUtilities'\r\nimport api from '../../services/api'\r\n\r\nconst MapContainer = ({ children }) => {\r\n  const hub = useRef(null)\r\n  const [sites, setSites] = useState([])\r\n  const [messages, setMessages] = useState([])\r\n  const [selected, setSelected] = useState(null)\r\n  const [alarm, setAlarm] = useState(null)\r\n\r\n  async function onMaintenanceStart() {\r\n    setSelected(ps => ({ ...ps, status: 'Pending' }))\r\n    await api.get(`/api/sites/${selected.id}/maintenance/start`)\r\n  }\r\n\r\n  async function onMaintenanceStop() {\r\n    setSelected(ps => ({ ...ps, status: 'Pending' }))\r\n    await api.get(`/api/sites/${selected.id}/maintenance/stop`)\r\n  }\r\n\r\n  useEffect(() => {\r\n    async function fetchSites() {\r\n      const response = await api.get('/api/sites')\r\n      setSites(response)\r\n    }\r\n\r\n    fetchSites()\r\n\r\n    hubConnectionBuilder(HUB_URL)\r\n      .then(con => {\r\n        hub.current = con\r\n\r\n        hub.current.on('SiteStatusChanged', message => {\r\n          console.info(\r\n            `${message.name}: ${message.previousStatus} -> ${\r\n              message.currentStatus\r\n            }`\r\n          )\r\n          setMessages(messages => [message, ...messages.slice(-100)])\r\n          setAlarm(message)\r\n        })\r\n\r\n        hub.current.on('SiteGuardingException', message => {\r\n          console.info('site exception:', message)\r\n        })\r\n      })\r\n      .catch(err => {\r\n        console.error(err)\r\n        hub.current = null\r\n      })\r\n\r\n    return () => {\r\n      if (hub.current) {\r\n        hub.current.stop()\r\n        hub.current = null\r\n      }\r\n    }\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!alarm) {\r\n      return\r\n    }\r\n\r\n    setSites(prevSites => {\r\n      const site = prevSites.find(x => x.id === alarm.id)\r\n      const idx = prevSites.indexOf(site)\r\n      prevSites.splice(idx, 1, { ...site, status: alarm.currentStatus })\r\n      return prevSites.slice()\r\n    })\r\n\r\n    setSelected(prevSelected => {\r\n      if (!prevSelected || prevSelected.id !== alarm.id) {\r\n        return prevSelected\r\n      }\r\n      return { ...prevSelected, status: alarm.currentStatus }\r\n    })\r\n  }, [alarm])\r\n\r\n  return React.Children.map(children, child =>\r\n    React.cloneElement(child, {\r\n      sites,\r\n      messages,\r\n      alarm,\r\n      selected,\r\n      setSelected,\r\n      onMaintenanceStart,\r\n      onMaintenanceStop\r\n    })\r\n  )\r\n}\r\n\r\nexport default MapContainer\r\n","import React from 'react'\r\nimport {\r\n  Map as LeafletMap,\r\n  TileLayer as LeafletTileLayer,\r\n  Marker as LeafletMarker\r\n} from 'react-leaflet'\r\nimport leaflet from 'leaflet'\r\nimport './map.css'\r\nimport { MAP_CENTER, TILE_LAYERS } from './mapUtilities'\r\n\r\nconst Map = ({ sites, selected, onSelect }) => {\r\n  return (\r\n    <LeafletMap center={MAP_CENTER} zoom={7} className=\"map\">\r\n      <LeafletTileLayer url={TILE_LAYERS.LIGHT} />\r\n      {sites\r\n        .filter(x => x.latitude > 0)\r\n        .map(site => (\r\n          <LeafletMarker\r\n            key={site.id}\r\n            position={{ lat: site.latitude, lng: site.longitude }}\r\n            icon={\r\n              new leaflet.DivIcon({\r\n                className: `marker-${site.status.toLowerCase()}${\r\n                  selected && selected.id === site.id ? ' marker-selected' : ''\r\n                }`\r\n              })\r\n            }\r\n            onclick={() => onSelect(site)}\r\n          />\r\n        ))}\r\n    </LeafletMap>\r\n  )\r\n}\r\n\r\nexport default Map\r\n","import React from 'react'\r\nimport { statusColor } from './mapUtilities'\r\n\r\nconst MapAlarm = ({ alarm, isExpanded }) => (\r\n  <p style={{ fontSize: 12, fontWeight: 'bolder' }}>\r\n    <span style={{ color: statusColor[alarm.currentStatus] }}>\r\n      [{new Date().toLocaleTimeString('el-GR')}]\r\n    </span>\r\n    <span style={{ color: 'white' }}>{alarm.name}</span>\r\n    <span style={{ color: statusColor[alarm.previousStatus] }}>\r\n      {alarm.previousStatus}\r\n    </span>\r\n    <span style={{ color: 'white' }}>&rarr;</span>\r\n    <span style={{ color: statusColor[alarm.currentStatus] }}>\r\n      {alarm.currentStatus}\r\n    </span>\r\n    {isExpanded && <span>({alarm.message})</span>}\r\n  </p>\r\n)\r\n\r\nexport default MapAlarm\r\n","import React, { useRef, useState } from 'react'\r\nimport { Icon as AntdIcon } from 'antd'\r\nimport MapAlarm from './MapAlarm'\r\nimport './map.css'\r\n\r\nconst MapAlarms = ({ alarms }) => {\r\n  const containerRef = useRef(null)\r\n  const [isExpanded, setIsExpanded] = useState(false)\r\n\r\n  function expand() {\r\n    containerRef.current.style.height = 'calc(100% - 100px)'\r\n    containerRef.current.style.width = '60vw'\r\n    setIsExpanded(true)\r\n  }\r\n\r\n  function shrink() {\r\n    containerRef.current.style.height = '200px'\r\n    containerRef.current.style.width = '450px'\r\n    setIsExpanded(false)\r\n  }\r\n\r\n  return (\r\n    <div className=\"map-alarms-container\" ref={containerRef}>\r\n      <div className=\"map-alarms-content\">\r\n        <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n          {!isExpanded ? (\r\n            <span className=\"is-link\" onClick={expand}>\r\n              <AntdIcon\r\n                type=\"arrows-alt\"\r\n                title=\"Μεγιστοποίηση\"\r\n                style={{ fontWeight: 'bolder' }}\r\n              />\r\n            </span>\r\n          ) : (\r\n            <span className=\"is-link\" onClick={shrink}>\r\n              <AntdIcon\r\n                type=\"shrink\"\r\n                title=\"Ελαχιστοποίηση\"\r\n                style={{ fontWeight: 'bolder' }}\r\n              />\r\n            </span>\r\n          )}\r\n        </div>\r\n        {alarms.map((alarm, idx) => (\r\n          <MapAlarm key={idx} alarm={alarm} isExpanded={isExpanded} />\r\n        ))}\r\n      </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default MapAlarms\r\n","import React from 'react'\r\nimport MapContainer from '../containers/MapContainer'\r\nimport Map from './Map'\r\nimport MapAlarms from './MapAlarms'\r\n\r\nconst WebMapLayoutView = ({\r\n  sites,\r\n  selected,\r\n  setSelected,\r\n  messages\r\n  //onMaintenanceStart,\r\n  //onMaintenanceStop\r\n}) => {\r\n  return (\r\n    <div style={{ height: '100vh', display: 'flex' }}>\r\n      <div style={{ flexGrow: 1 }}>\r\n        <Map\r\n          sites={sites}\r\n          selected={selected}\r\n          onSelect={setSelected}\r\n          zoom={9}\r\n          style={{ height: '100vh' }}\r\n        />\r\n        <svg hidden>\r\n          <filter id=\"map-filter\">\r\n            <feColorMatrix\r\n              type=\"matrix\"\r\n              values=\"0.2 0 0 0 0  0 0.3 0 0 0  0 0 0.4 0 0  0 0 0 1 0\"\r\n            />\r\n          </filter>\r\n        </svg>\r\n      </div>\r\n      <MapAlarms alarms={messages} />\r\n    </div>\r\n  )\r\n}\r\n\r\nconst WebMapLayout = () => (\r\n  <MapContainer>\r\n    <WebMapLayoutView />\r\n  </MapContainer>\r\n)\r\n\r\nexport default WebMapLayout\r\n"],"sourceRoot":""}